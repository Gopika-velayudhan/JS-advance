var fe=Object.defineProperty;var ge=(t,n,r)=>n in t?fe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;var j=(t,n,r)=>(ge(t,typeof n!="symbol"?n+"":n,r),r);import{r as g,j as e}from"./index-62e24e5e.js";import{c as ee,b as xe,d as L,e as v,f as y,g as D,S as u,T as f,h as te,i as V,j as E,a as C,k as be,l as Ce,m as se,n as F,o as N,u as je,p as ne,q as ye,s as Se,B as ve,t as k,I as Ee,v as oe,w as Pe,x as Ae,y as Ie,G as w,z as Te,A as Ne,C as we,E as Oe,F as Re,H as _e,J as K,K as Be,M as De,N as ke,O as _,Q as Me,R as Le,U as Fe,r as Ge}from"./_VitePage-80bebc7b.js";import{u as ze,a as Ue,b as $e,c as He,O as We,d as Ye,e as X,f as qe,g as Ve,h as Ke,i as Xe,j as Je,k as P,p as G,l as z,m as U,n as Qe,o as Ze,q as et,r as tt,E as M,B as re,s as $,A as st,I as nt,t as ot,v as rt,w as it,x as at,P as ct,y as lt,S as dt,z as ut,C as ht,D as pt,F as mt}from"./InitPitcher-db4f15a5.js";import{S as ft,u as gt,a as xt,E as bt,b as Ct,c as jt,g as yt,d as St,T as vt,A as Et,F as Pt,L as At,e as It,f as Tt,P as Nt,h as wt}from"./SessionMatcher-3b8d5eb5.js";import"./index-51cd78ab.js";import{w as J,R as Ot,P as Rt,c as ie,l as _t,r as Bt}from"./csb-model-d01e4de4.js";import{R as Dt}from"./humps-32535f22.js";import{d as ae}from"./index-ade6fc8b.js";import{m as ce}from"./motion-82921620.js";import"./pitcher-f33d030c.js";import"./browserDetection-7188541e.js";import"./index-4e64f695.js";import"./assistantClientAvatar-261bf91c.js";import"./useOpenInVsCode-23252cfc.js";import"./ClientsList-75bba962.js";import"./usePreviewProtocol-87dfcd9e.js";import"./index-8d4c1d59.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="773c7514-f779-4fc5-b7db-ce0ea60b34b4",t._sentryDebugIdIdentifier="sentry-dbid-773c7514-f779-4fc5-b7db-ce0ea60b34b4")}catch{}})();const kt=ee({usePersistedLayout:ze,useLayout:Ue,useLayoutDispatcher:$e}),Mt=()=>{const t=xe(),[n,r]=He(),{storage:o,visibility:s}=L(),i=v(),c=y(),a=o.get(We),l=o.get(Ye),h=o.get(X),m=c.type==="sandbox"&&c.isCloud===!1,p=()=>{i("onboarding_show_me_around",{event_source:"editor"}),r({type:"START_ONBOARDING"})},x=()=>{i("onboarding_book_a_call",{event_source:"editor"}),window&&window.open(qe.calendly.bookAChat,"_blank")},d=()=>{i("onboarding_no_thanks",{event_source:"editor"}),o.set(X,!0)};return g.useEffect(()=>{!a&&!l&&!h&&!s.isInIframe&&!m&&t({message:"Want a quick tour of CodeSandbox? Learn about our features and optimize your experience.",showDismiss:!1,uniqueName:"take-a-tour",actions:[{text:"Show me around",onAction:p},{text:"Book a call",onAction:x},{text:"No, Thanks",onAction:d}]})},[]),null},Lt=ee({usePRComments:Ve,useCommentPopups:Ke,useReviews:Xe}),H=({open:t,maxWidth:n,onInteractOutside:r=s=>s.preventDefault(),children:o})=>e.jsx(D,{contentProps:{onInteractOutside:r,css:{maxWidth:n||500,userSelect:"text"}},onOpenChange:()=>{},open:t,children:o}),Ft=({children:t})=>{const[n,r]=g.useState({open:!1,children:null});return e.jsxs(Je.Provider,{value:r,children:[t,e.jsx(H,{maxWidth:n.maxWidth||500,onInteractOutside:o=>{n.closeOnInteractOutside?r(s=>({...s,open:!1})):o.preventDefault()},open:n.open,children:n.children})]})},S=({children:t,title:n,description:r,error:o,warning:s,message:i})=>e.jsxs(W,{gap:4,horizontal:!1,children:[e.jsxs(u,{horizontal:!0,children:[e.jsxs(u,{css:{flex:1},children:[e.jsx(f,{css:{color:"$neutral-bg-contrast"},children:n}),e.jsx(f,{children:r}),o?e.jsx(f,{color:"informative-error-base",children:o}):null,s?e.jsx(f,{color:"informative-warning-base",children:s}):null]}),e.jsx(u,{children:t})]}),i]}),W=t=>e.jsx(u,{css:{justifyContent:"space-between",width:"100%",paddingBottom:"$6",borderBottom:"1px solid $neutral-bg-medium"},horizontal:!0,...t}),Gt=()=>{const{colorSchemas:t,setCurrentTheme:n,theme:r}=te(),[o,s]=P("VSCODE_VIM_EXTENSION",!1),[i,c]=P("CURSOR_POINTER",!0),{aiConsent:a}=y(),l=v(),[h,m]=P("AI/CODE_COMPLETION",!1);g.useEffect(()=>{document.documentElement.style.setProperty("--csb-cursor",i?"pointer":"default")},[i]);const[p,x]=g.useState(!1);return e.jsxs(u,{gap:5,children:[e.jsx(S,{description:"Select your editor color scheme",title:"Themes",children:e.jsx(V,{onValueChange:d=>n(t.find(A=>A.schemaName===d)),placeholder:r.schemaName,children:t.map(d=>e.jsxs(V.Item,{value:d.schemaName,children:[d.schemaName," (",d.theme,")"]},d.schemaName))})}),e.jsxs(W,{gap:4,horizontal:!1,children:[e.jsxs(u,{horizontal:!0,children:[e.jsxs(u,{css:{flex:1},children:[e.jsx(u,{horizontal:!0,children:e.jsx(f,{css:{color:"$neutral-bg-contrast"},children:"Enable VIM extension"})}),e.jsx(f,{css:{maxWidth:600,a:{color:"$neutral-bg-contrast"}},children:"Use the command palette to control VIM"})]}),e.jsx(u,{children:e.jsx(E,{"aria-label":"Enable VIM extension",defaultChecked:o,onCheckedChange:d=>{s(d),x(!0)}})})]}),p&&e.jsxs(u,{horizontal:!0,children:[e.jsx(f,{color:"informative-warning-base",css:{flex:1},children:"You need to refresh the browser for this to take effect, do you want to do that now?"}),e.jsx(C,{onClick:()=>window.location.reload(),variant:"secondary",children:"Reload"})]})]}),e.jsx(S,{description:"All interactive elements show a pointer cursor on hover",title:"Use pointer cursors",children:e.jsx(be,{content:i?"Shows pointer cursors":"Shows default cursors",children:e.jsx(E,{defaultChecked:i,onCheckedChange:d=>{c(d)}})})}),e.jsx(S,{description:"Supercharge your development with Codeium’s code completion tool",message:a?null:e.jsxs(f,{color:"informative-warning-base",css:{a:{textDecoration:"underline","&:hover":{textDecoration:"none"}}},children:["To enable this, first you need to"," ",e.jsx("a",{href:G.dashboard.permission(),children:"consent to AI features"}),"."]}),title:"AI Codeium code auto-complete",children:e.jsx(E,{defaultChecked:h,disabled:!a,onCheckedChange:d=>{d===!0?l("codeium_enable",{location:"settings"}):l("codeium_disable",{location:"settings"}),m(d)}})})]})},zt=()=>{const t=Ce(),n=[e.jsx(S,{description:"Run your sandboxes in a faster and more stable editor.",title:"Sandbox beta editor",children:e.jsx(C,{as:"a",href:G.dashboard.experiments(t==null?void 0:t.id),children:"Open dashboard Preferences"})})];return e.jsx(u,{gap:5,children:n.length>0?n:e.jsx(f,{color:"neutral-fg-subtle",children:"No experiments available"})})},Ut=()=>{const{setVisibility:t}=z();return e.jsxs(u,{css:{justifyContent:"space-between"},horizontal:!0,children:[e.jsx(f,{color:"neutral-fg-base",size:"sm",weight:"medium",children:"Settings"}),e.jsx(C,{icon:"close",onClick:()=>t(!1)})]})},$t=F("setBranchProtection",t=>({setBranchProtection:[t,{id:!0}]})),Ht=()=>{const t=se();return n=>t.gql.query($t,n)},Wt=F("UPDATE_SANDBOX_AI_CONSENT",({sandboxId:t,aiConsent:n})=>({updateSandboxSettings:[{sandboxId:t,aiConsent:n},{aiConsent:!0}]})),Yt=F("UPDATE_PROJECT_AI_CONSENT",({projectId:t,aiConsent:n})=>({updateProjectSettings:[{projectId:t,aiConsent:n},{aiConsent:!0}]})),qt=()=>{const t=se(),n=y(),[,r]=N();return()=>{const o=!n.aiConsent;let s;return n.type==="branch"?s=t.gql.query(Yt,{projectId:n.projectId,aiConsent:o}):s=t.gql.query(Wt,{sandboxId:n.id,aiConsent:o}),r({type:"SET_AI_CONSENT",aiConsent:o}),s.catch(i=>{throw r({type:"SET_AI_CONSENT",aiConsent:!o}),i})}},le=()=>{const{aiConsent:t}=y(),{isTeamAdmin:n}=U(),r=qt(),o=v(),s=je(),i=Qe(),[c,a]=g.useState(!1),[l,h]=g.useState(!1),m=()=>{h(!0),a(!0),r().catch(()=>{s({status:"error",message:"Could not toggle AI consent, please try again or refresh"})}).finally(()=>{o("ai_consent"),a(!1)})};return e.jsxs(W,{gap:4,horizontal:!1,children:[e.jsxs(u,{horizontal:!0,children:[e.jsxs(u,{css:{flex:1},children:[e.jsx(u,{horizontal:!0,children:e.jsxs(f,{css:{color:"$neutral-bg-contrast"},children:["Enable AI features"," "]})}),e.jsxs(f,{css:{maxWidth:600,a:{color:"$neutral-bg-contrast"}},children:["Boost the productivity of your project with tailor-made AI features. Read more about data collection in the"," ",e.jsx("a",{href:"https://codesandbox.io/legal/privacy",rel:"noreferrer",target:"_blank",children:"Privacy Policy"})]}),n?null:e.jsx(f,{color:"informative-warning-base",children:"Only administrators within your CodeSandbox team have access to this."})]}),e.jsx(u,{children:e.jsx(E,{"aria-label":"Enable AI features",defaultChecked:t,disabled:!n||c,onCheckedChange:m})})]}),l&&e.jsxs(u,{horizontal:!0,children:[e.jsx(f,{color:"informative-warning-base",css:{flex:1},children:"For the changes to take effect, you need to restart the instance"}),e.jsx(C,{onClick:i.perform,variant:"secondary",children:i.name})]})]})},Vt=()=>e.jsxs(u,{gap:5,children:[e.jsx(Kt,{}),e.jsx(ft,{children:e.jsx(Xt,{})}),e.jsx(le,{}),e.jsx(Jt,{})]}),Kt=()=>{const t=Ht(),[n,r]=g.useState(null),o=ne(),[s]=Ze(),[i,c]=g.useState(!1),a=m=>{try{t({protected:m,branchId:o.id}),r(null),c(!0)}catch{r("There was an error setting the protected status of this branch.")}},l=s.status.conflicts?"You need to fix your conflicts to change this setting.":s.status.localChanges?"You need to commit your files to change this setting.":s.status.isMerging?"You need to finish your merge to change this setting.":void 0,h=n||l;return e.jsx(S,{description:"Prevent changes from being made in the current branch.",error:h,message:i&&e.jsxs(u,{horizontal:!0,children:[e.jsx(f,{color:"informative-warning-base",css:{flex:1},children:"For the changes to take effect, you need to reload the page"}),e.jsx(C,{onClick:()=>window.location.reload(),variant:"secondary",children:"Reload page"})]}),title:"Protect current branch",children:e.jsx(E,{"aria-label":"Protect current branch",defaultChecked:o.protectedBranch,disabled:s.status.localChanges||s.status.conflicts||s.status.isMerging,onCheckedChange:a})})},Xt=()=>{const[t,n]=N(),r=ne(),{openNewWindow:o,resetWindowControl:s}=gt("gh_app_install_from_settings"),[{data:i}]=xt({owner:r.owner,repo:r.repo});return g.useEffect(function(){(i==null?void 0:i.githubEvents.action)==="CREATED"&&(s(),n({type:"SET_GITHUB_APP"}))},[i]),e.jsx(S,{description:"Get a live dev environment and a preview for every PR",title:"Install GitHub App",children:e.jsx(C,{disabled:r.githubAppInstalled,onClick:o,variant:"secondary",children:r.githubAppInstalled?"Installed":"Install app"})})},Jt=()=>{const[t,n]=et();return e.jsx(S,{description:"Toggle opening previews automatically in the devtool panel for this project and device. When turned off open previews from the task or the devtools panel.",title:"Open previews automatically",children:e.jsx(E,{"aria-label":"Open previews automatically",defaultChecked:t,onCheckedChange:()=>n(!t)})})},Qt=()=>{const t=ye();return e.jsx(u,{gap:5,children:t.isCloud?e.jsx(le,{}):e.jsx(f,{children:"No options."})})},Zt=t=>({...t==="branch"&&{repository:Vt},env:jt,devbox:Qt,preferences:Gt,experiments:zt}),es=()=>{const t=y(),{visible:n,setVisibility:r,activeTab:o}=z(),i=Zt(t.type)[o];return e.jsx(H,{maxWidth:950,onInteractOutside:()=>r(!1),open:n,children:e.jsx(bt,{context:"SETTINGS",children:e.jsxs(u,{css:{height:Se(110)},gap:6,children:[e.jsx(Ut,{}),e.jsxs(u,{css:{minHeight:0,flex:1},gap:8,horizontal:!0,children:[e.jsx(Ct,{}),i?e.jsx(ve,{"aria-live":"polite",css:{height:"100%",width:"100%",marginTop:"$3",overflow:"auto"},role:"tabpanel",children:e.jsx(i,{visible:n})}):null]})]})})})};function de(t){return t<128?1:t<2048?2:t<65536?3:4}function Q(t,n){if(n===0)return 0;let r=0,o=0;for(const s of t)if(o+=s.length,r+=de(s.codePointAt(0)),n!==void 0&&o>=n)break;return r}function Z(t,n){if(n===0)return 0;let r=0,o=0;for(const s of t)if(o+=de(s.codePointAt(0)),r+=s.length,n!==void 0&&o>=n)break;return r}const ue=5e4;function ts(t,n){const r=new Set,o=[];for(let s=t.length-1;s>=0;s--){const i=t[s];if(i.model.type!=="code")continue;const c=i.model.uri.toString();c!==n.uri.toString()&&(r.has(c)||i.model.language===n.languageId&&(r.add(c),o.push(c)))}return o}function ss(t){const{history:n,currentDocument:r,utf16CodeUnitOffset:o,getOpenModel:s,getText:i}=t,c=ts(n,r),a=i(r),l=c.map(x=>{const d=s(x);return d?i(d):""}).filter(x=>x&&x.length<ue).slice(0,3).join(`

`);let h=Q(l),m="";l.length>0&&(m+=l,m+=`

`,h+=2),m+=a;const p=Q(a,o);return{text:m,utf8ByteOffset:p,additionalUtf8ByteOffset:h}}function ns(t,n,r,o){if(!t.completion||!t.range)return;const s=n.getText(),i=n.positionAt(Z(s,t.range.startOffset-r)),c=n.positionAt(Z(s,t.range.endOffset-r)),a=new Ot(i,c);let l=t.completion.text,h=()=>{};if(t.suffix&&t.suffix.text.length>0){let p;o.activeTextEditorControl&&(typeof o.activeTextEditorControl.getModifiedEditor<"u"?p=o.activeTextEditorControl.getModifiedEditor():p=o.activeTextEditorControl);const x=p==null?void 0:p.getModel();if((x==null?void 0:x.uri.toString())===n.uri.toString()){l+=t.suffix.text;const d=Number(t.suffix.deltaCursorOffset);h=()=>{const A=p==null?void 0:p.getSelection();if(A==null){console.warn("Unexpected, no selection");return}const O=A.getPosition(),Y=new Rt(O.lineNumber,O.column),b=n.positionAt(n.offsetAt(Y)+d);p==null||p.setSelection(new Dt(b.line,b.character,b.line,b.character)),ie.executeCommand("editor.action.inlineSuggest.trigger")}}}return{insertText:l,range:a,command:{title:"Accept Completion",command:"codeium.acceptCompletion",arguments:[t.completion.completionId,h]}}}class os{constructor(n,r,o){j(this,"openModels",new Map);this.editorService=n,this.historyService=r,this.toggleLoadingState=o,J.onDidOpenTextDocument(s=>{this.openModels.set(s.uri.toString(),s)}),J.onDidCloseTextDocument(s=>{this.openModels.delete(s.uri.toString())})}computeTextAndOffsets(n,r){return ss({history:this.historyService.getHistory(),currentDocument:n,utf16CodeUnitOffset:n.offsetAt(r),getText:o=>o.getText(),getOpenModel:o=>this.openModels.get(o)})}async provideInlineCompletionItems(n,r,o,s){const i=new AbortController;if(s.onCancellationRequested(()=>{i.abort()}),s.isCancellationRequested)return[];const c=n.getText().length;if(c>ue)return console.warn("Bailing out of autocomplete for large document:",n.uri,c),[];const{text:a,utf8ByteOffset:l,additionalUtf8ByteOffset:h}=this.computeTextAndOffsets(n,r),m={document:{text:a,language:n.languageId,cursorOffset:l+h,lineEnding:n.eol===1?`
`:`\r
`},editorOptions:{tabSize:2,insertSpaces:!0}};return this.toggleLoadingState(!0),(await yt(m,i.signal).finally(()=>{this.toggleLoadingState(!1)})).map(d=>ns(d,n,h,this.editorService)).filter(Boolean)}}class rs extends ae.Disposable{constructor(r,o,s){super();j(this,"statusBarItem");j(this,"timer");j(this,"setStatusBarTitle",r=>{this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.statusBarItem&&(this.statusBarItem.text=r?"Codeium: $(sync~spin)":"Codeium: {…}",this.statusBarItem.show())},100)});this.initialize(r,o,s)}async initialize(r,o,s){this.addDisposable(ie.registerCommand("codeium.acceptCompletion",(c,a)=>{s(),St(c).then(()=>{a==null||a()}).catch(l=>{console.error(l)})})),await this.createStatusBarItem();const i=_t.registerInlineCompletionItemProvider(["typescript","typescriptreact","javascriptreact","css","rust","sql","python","vue","svelte","php","lua","elixir","ruby","go"].map(c=>({language:c})),new os(r,o,this.setStatusBarTitle));this.addDisposable(i)}async createStatusBarItem(){const{getApi:r,dispose:o}=Bt({name:"Codeium Extension for CodeSandbox",publisher:"codesandbox",version:"1.0.0",engines:{vscode:"*"},contributes:{}},1);this.addDisposable({dispose:o});const s=await r();this.statusBarItem=s.window.createStatusBarItem(s.StatusBarAlignment.Right,1/0),this.setStatusBarTitle(!1),this.statusBarItem.command="codeium.open",this.statusBarItem.show(),this.addDisposable({dispose:()=>{var i;(i=this.statusBarItem)==null||i.dispose()}})}}class is extends ae.Disposable{constructor(){super();j(this,"codeEditorService");j(this,"editorService");j(this,"history",[]);j(this,"historyCursor",-1);j(this,"ignoreNextPushState",!1);j(this,"activeEditorDisposable",null);this.codeEditorService=k.get(Ee),this.editorService=k.get(oe),this.initializeListeners(),this.editorService.activeTextEditorControl&&this.pushState()}getHistory(){return this.history}initializeListeners(){this.addDisposable(this.editorService.onDidActiveEditorChange(()=>{this.pushState(),this.registerEditorListeners()}))}registerEditorListeners(){this.activeEditorDisposable&&this.activeEditorDisposable.dispose();const r=this.codeEditorService.getFocusedCodeEditor();r&&(this.activeEditorDisposable=this.addDisposable(r.onDidChangeCursorSelection(o=>{const s=this.history[this.historyCursor].selection;cs(s,o.selection)||this.pushState()})))}pushState(){if(this.ignoreNextPushState){this.ignoreNextPushState=!1;return}const r=this.editorService.activeTextEditorControl;if(!r)return;const o=r.getModel();if(!o)return;const s=r.getSelection();s&&(this.history.length=this.historyCursor+1,"uri"in o?this.history.push({model:{type:"code",language:o.getLanguageId(),uri:o.uri},selection:s}):this.history.push({model:{type:"diff",language:o.modified.getLanguageId(),originalUri:o.original.uri,modifiedUri:o.modified.uri},selection:s}),this.history.length>100&&this.history.shift(),this.historyCursor=this.history.length-1)}}const as=10;function cs(t,n){if(!t||!n)return!1;const r=Math.min(t.startLineNumber,t.endLineNumber),o=Math.min(n.startLineNumber,n.endLineNumber);return Math.abs(r-o)<as}const ls=({close:t})=>{const n=v();g.useEffect(()=>{n("codeium_opened_modal")},[]);const[r,o]=P("AI/CODE_COMPLETION",!1),s=()=>{o(!0),t(),n("codeium_enable",{location:"modal"})},i=()=>{r||o(!1),t(),n("codeium_closed_modal")},c=ds({enabled:r,enableFeature:s,cancel:i});return e.jsxs(u,{children:[e.jsxs(u,{css:{justifyContent:"space-between"},horizontal:!0,children:[e.jsx(Pe,{css:{display:"inline-flex"},children:"New"}),e.jsx(C,{icon:"close",onClick:i})]}),e.jsx(f,{size:"xl",children:"Code auto-complete."}),e.jsx(f,{size:"md",children:c.title}),e.jsx(u,{css:{marginTop:"$8",paddingBottom:"$2"},horizontal:!0,children:c.actions}),c.note&&e.jsx(f,{color:"neutral-fg-base",children:c.note})]})},he=()=>tt(ls,{maxWidth:720}),ds=({enabled:t,enableFeature:n,cancel:r})=>{const{aiConsent:o}=y(),{isFree:s,isTeamAdmin:i}=U(),{setActiveTab:c,setVisibility:a}=z();let l="Supercharge your development with Codeium’s code completion tool.";if(s&&(l+=" Get started for free."),o&&t)return{title:l,actions:[e.jsx(C,{onClick:()=>{r(),a(!0),c("preferences")},children:"Manage settings"},"settings"),e.jsx(B,{},"learn")]};if(i){const h=o?e.jsx(C,{onClick:()=>{n()},variant:"primary",children:"Proceed"},"proceed"):e.jsx(C,{as:"a",href:G.dashboard.permission(),variant:"primary",children:"Grant permission"},"proceed");return{title:l,actions:[h,e.jsx(B,{},"learn")],note:o?"by clicking proceed you are accepting terms & conditions":""}}else return{title:l,actions:[e.jsx(C,{disabled:!o,onClick:n,variant:"primary",children:"Proceed"},"proceed"),e.jsx(B,{},"learn")],note:o?"You can disable it anytime from the settings page.":"Please contact your admin to get access and enable AI features."}},B=()=>e.jsx(C,{as:"a",href:"https://codesandbox.io/docs/learn/ai/codeium",target:"_blank",children:"Learn more"}),us=()=>{const{monacoEditor:t}=L(),n=t.libraryState.state,{open:r}=he(),o=v(),s=()=>{o("codeium_insert_suggestion")};return g.useEffect(()=>{if(n==="LOADED"){const i=new is,c=new rs(k.get(oe),i,s),a=t.libraryState.monaco.editor.registerCommand("codeium.open",r);return()=>{c.dispose(),a.dispose(),i.dispose()}}},[n]),null},hs=()=>{const{open:t}=he(),n=y(),[r]=Ae(),[o]=P("AI/CODE_COMPLETION",!1),[s]=P("AI_BANNER_ANNOUNCEMENT_DISCARDED",!1),{isTeamAdmin:i}=U(),c=r.state==="AUTHENTICATED",a=n.type==="sandbox"&&n.isCloud,l=n.type==="branch",h=a||l,m=c&&h&&n.aiConsent&&o;return g.useEffect(()=>{const p=Ie.get("CSB/AI/CODE_COMPLETION")===null,x=(()=>typeof i=="boolean"?i?!n.aiConsent&&s:!0:!1)();c&&h&&p&&x&&t()},[h,c,i]),m?e.jsx(us,{}):null},ps=()=>e.jsxs(e.Fragment,{children:[e.jsx(vt,{}),e.jsx(Et,{})]}),ms=({context:t,error:n,branchId:r})=>e.jsx(w,{context:{branchId:r,error:n,event:t.event,state:t.state},errorCode:"MICROVM_NOT_STARTED"}),fs=()=>{const t=Te(),[,n]=Ne(),r=y(),o=v();return e.jsxs(H,{maxWidth:500,open:!0,children:[e.jsx(D.Title,{children:"Lost Connection"}),e.jsx(D.Description,{children:"We are unable to reconnect you. Please check that you are online before trying again. If the problem persists, it means the development environment has reached an error state and you can try restarting it. Don't worry, your work will still be here when you get back."}),e.jsxs(u,{css:{justifyContent:"flex-end"},horizontal:!0,children:[e.jsx(C,{disabled:!(r.type==="branch"?we(r.authorization):Oe(r.authorization,"write_project")),onClick:()=>{n({type:"RESTART_CONTAINER"})},autoFocus:!0,children:"Restart"}),e.jsx(C,{onClick:()=>{o("manual_reconnect",{event_source:"editor"}),t.reconnect().catch(()=>{})},variant:"primary",children:"Reconnect"})]})]})},gs=({id:t,seamlessFork:n,children:r})=>{const o=L(),[s,i]=g.useState({state:"INITIALIZING"});switch(o.csbApi,g.useEffect(()=>{let c=!0;return o.pitcherInstanceManager.getBrowserInstance(t,n).then(a=>{if(c===!1){a.dispose();return}i({state:"READY",client:a})}).catch(a=>{c&&i({state:"ERROR",error:a})}),()=>{c=!1,s.state==="READY"&&s.client.dispose()}},[]),g.useEffect(()=>{window.onbeforeunload=c=>{s.state==="READY"&&s.state==="READY"&&s.client.clients.file.hasDirtyFiles()&&!window.confirm("You have unsaved changes in your editor, are you sure you want to navigate away?")&&c.preventDefault()}},[s]),s.state){case"INITIALIZING":return e.jsx(M,{isLoadingEditorType:"sandbox",children:e.jsx(re,{loadingBarEnd:100,loadingBarProgress:0,loadingBarSpeed:6,children:"Loading..."})});case"ERROR":return e.jsx(M,{children:e.jsx(w,{context:{error:String(s.error),branchId:t,state:"ERROR",event:"Not able to load sandbox browser instance"},errorCode:"SANDBOX_NOT_STARTED"})});case"READY":return e.jsx(ce.div,{animate:{opacity:1},exit:{opacity:0},initial:{opacity:0},children:e.jsx(Re,{client:s.client,id:t,children:e.jsx(_e,{client:s.client,children:r})})})}},T=({editor:t})=>{const{stopBranchingAnimation:n}=ht(),[,r]=N(),o=$(),s=rt(),i=it(),{registerColorSchemas:c,mapColorSchemaToTheme:a,theme:l}=te(),{MaybeAssistantCommitProvider:h,ForkProvider:m,MaybeGitProvider:p,MaybePRReviewsProvider:x}=g.useMemo(()=>({MaybePRReviewsProvider:({children:b})=>t.type==="branch"?e.jsx(Lt,{useCommentPopups:{},usePRComments:{},useReviews:{},children:b}):b,MaybeGitProvider:({children:b})=>t.type==="branch"?e.jsx(ut,{branchId:t.id,targetBranchName:t.targetBranchName,children:b}):b,ForkProvider:({children:b})=>{var q;return t.type==="branch"?e.jsx(It.Provider,{authorization:t.authorization,branch:t.branch,defaultBranchName:t.defaultBranchName,onBranchCreateError:()=>{n()},onBranchCreateSuccess:I=>{r({type:"SWITCH_BRANCH",name:I})},onFork:({owner:I,repo:R,branch:pe,workspaceId:me})=>{o.branch.goToBranch({owner:I,repo:R,branch:pe,workspaceId:me})},owner:t.owner,repo:t.repo,workspaceId:((q=t.workspace)==null?void 0:q.id)??null,children:b}):e.jsx(Tt.Provider,{id:t.id,isCloud:t.isCloud,onFork:({alias:I,workspaceId:R})=>{r({type:"SWITCH_SANDBOX",alias:I,workspaceId:R})},children:b})},MaybeAssistantCommitProvider:({children:b})=>t.type==="branch"?e.jsx(Nt,{children:b}):b}),[]);return e.jsx(at.Provider,{router:o,children:e.jsx(x,{children:e.jsx(kt,{useLayout:{tasks:s,terminals:Array.from(i.values())},useLayoutDispatcher:{},usePersistedLayout:{router:o},children:e.jsxs(ct,{children:[e.jsx(lt,{}),e.jsxs(p,{children:[t.type==="branch"&&t.pullRequest?e.jsx(ke,{title:`#${t.pullRequest.number} ${t.pullRequest.title}`}):null,e.jsx(Pt,{assetPaths:{staticModulesPath:_("/static_modules"),webWorkersPath:_("/workers"),textMateLanguagesPath:_("/textmate-languages")},initialTheme:l.schemaName,mapColorSchemaToTheme:a,registerColorSchemas:c,children:e.jsx(m,{children:e.jsxs(Me,{fallback:({error:d})=>(console.error(d),e.jsx(w,{context:{error:d.message},errorCode:"RUNTIME_ERROR"})),children:[e.jsx(dt,{children:e.jsx(Ft,{children:e.jsxs(h,{children:[e.jsx(es,{}),e.jsx(At,{}),e.jsx(hs,{})]})})}),e.jsx(Mt,{}),e.jsx(ps,{})]})})})]})]})})})})},xs=()=>{const[t]=N(),n=$(),r=v();g.useEffect(()=>{t.state==="READY"&&r("editor_loaded",{type:t.editor.type,isCloud:t.editor.type==="sandbox"?t.editor.isCloud:!0})},[t]);const o=s=>{const i=window.location.search.includes("forceBrowser=true")||s.type==="sandbox"&&!s.isCloud?gs:nt;return e.jsx(e.Fragment,{children:e.jsx(i,{editorType:s.type,id:s.id,seamlessFork:ot(s),children:e.jsx(Be,{branchId:s.id,children:e.jsx(De,{children:([c])=>K(c,{RESTARTING:a=>e.jsx(e.Fragment,{children:e.jsx(T,{container:a,editor:s})}),ERROR:({context:a,error:l})=>e.jsx(ms,{branchId:s.id,context:a,error:l}),DISCONNECTED:a=>e.jsxs(e.Fragment,{children:[e.jsx(T,{container:a,editor:s}),a.wasCleanDisconnect?null:e.jsx(fs,{})]}),DISCONNECTED_RECONNECTING:a=>e.jsx(e.Fragment,{children:e.jsx(T,{container:a,editor:s})}),READY:a=>e.jsx(e.Fragment,{children:e.jsx(T,{container:a,editor:s})}),RECONNECTING:a=>e.jsx(e.Fragment,{children:e.jsx(T,{container:a,editor:s})})})})})})})};return e.jsx(st,{children:K(t,{READY:({editor:s})=>o(s),RENAMING_BRANCH:({editor:s})=>o(s),REMOVING_BRANCH:({editor:s})=>o(s),FETCHING:({type:s})=>e.jsx(ce.div,{animate:{opacity:1},exit:{opacity:0},children:e.jsx(M,{isLoadingEditorType:s,children:e.jsx(re,{loadingBarProgress:0,loadingBarSpeed:4,children:n.branch.queryParams.create.get()?"Creating branch...":"Fetching details..."})})}),ERROR:({error:s,couldNotAccessWorkspace:i,possibleWorkspacesToRequestAccess:c})=>{let a="UNKNOWN_ERROR";const l=n.type==="sandbox";return i&&c&&c.length>0?a="REQUEST_WORKSPACE_ACCESS":i||s.includes("log in")||s.includes("not authenticated")||s.includes("not authorized")?a="NO_WORKSPACE_ACCESS":s.includes('"Sandbox not found"')||s==="NOT_FOUND"&&l||s.includes("NOT_FOUND")&&l?a="SANDBOX_NOT_FOUND":s.includes('"Repository not found"')||s.includes('"Repository or branch not found"')||s.includes('"Project or branch not found"')||s==="NOT_FOUND"?a="REPOSITORY_NOT_FOUND":s.includes('"Branch not found"')&&(a="BRANCH_NOT_FOUND"),e.jsx(w,{context:{error:s},errorCode:a,possibleWorkspacesToRequestAccess:c})}})})},bs=()=>{const t=$();return g.useEffect(()=>{pt()},[]),e.jsx(wt,{children:e.jsx(Le,{children:e.jsx(Fe,{router:t,type:t.type==="branch"?"branch":"sandbox",children:e.jsx(xs,{})})})})};Ge(()=>e.jsx(mt,{children:e.jsx(bs,{})}));
//# sourceMappingURL=Editor-c0071256.js.map
